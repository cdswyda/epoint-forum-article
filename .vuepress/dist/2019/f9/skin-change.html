<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>F9 换肤实现方式优化 | article</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/article/.vuepress/dist/assets/css/0.styles.f352b9c6.css" as="style"><link rel="preload" href="/article/.vuepress/dist/assets/js/app.fb069581.js" as="script"><link rel="preload" href="/article/.vuepress/dist/assets/js/2.b967c328.js" as="script"><link rel="preload" href="/article/.vuepress/dist/assets/js/6.d2e3d37b.js" as="script"><link rel="prefetch" href="/article/.vuepress/dist/assets/js/10.147aac08.js"><link rel="prefetch" href="/article/.vuepress/dist/assets/js/3.9b5bdf72.js"><link rel="prefetch" href="/article/.vuepress/dist/assets/js/4.81f5ff48.js"><link rel="prefetch" href="/article/.vuepress/dist/assets/js/5.0d9a27f7.js"><link rel="prefetch" href="/article/.vuepress/dist/assets/js/7.bd6966f0.js"><link rel="prefetch" href="/article/.vuepress/dist/assets/js/8.3f721f43.js"><link rel="prefetch" href="/article/.vuepress/dist/assets/js/9.a94158e7.js">
    <link rel="stylesheet" href="/article/.vuepress/dist/assets/css/0.styles.f352b9c6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/article/.vuepress/dist/" class="home-link router-link-active"><!----> <span class="site-name">article</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/article/.vuepress/dist/" class="nav-link">Home</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/article/.vuepress/dist/" class="nav-link">Home</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>响应式网页</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/article/.vuepress/dist/2018/about-responsive-web.html" class="sidebar-link">响应式网页是什么</a></li><li><a href="/article/.vuepress/dist/2018/how-to-responsive-web.html" class="sidebar-link">开发响应式网页</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/article/.vuepress/dist/2018/how-to-responsive-web.html#是否需要设计开发成响应式网页" class="sidebar-link">是否需要设计开发成响应式网页</a></li><li class="sidebar-sub-header"><a href="/article/.vuepress/dist/2018/how-to-responsive-web.html#响应式步骤" class="sidebar-link">响应式步骤</a></li></ul></li></ul></section></li><li><a href="/article/.vuepress/dist/2019/f9/skin-change.html" class="active sidebar-link">F9 换肤实现方式优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/article/.vuepress/dist/2019/f9/skin-change.html#常规方式的问题：" class="sidebar-link">常规方式的问题：</a></li><li class="sidebar-sub-header"><a href="/article/.vuepress/dist/2019/f9/skin-change.html#新的实现方案" class="sidebar-link">新的实现方案</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/article/.vuepress/dist/2019/f9/skin-change.html#核心原理-alternative-style-sheets" class="sidebar-link">核心原理 - alternative style sheets</a></li><li class="sidebar-sub-header"><a href="/article/.vuepress/dist/2019/f9/skin-change.html#实现-demo" class="sidebar-link">实现 demo</a></li><li class="sidebar-sub-header"><a href="/article/.vuepress/dist/2019/f9/skin-change.html#实现总结" class="sidebar-link">实现总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/article/.vuepress/dist/2019/f9/skin-change.html#在-f9-中的应用" class="sidebar-link">在 F9 中的应用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/article/.vuepress/dist/2019/f9/skin-change.html#输出所有的样式文件" class="sidebar-link">输出所有的样式文件</a></li><li class="sidebar-sub-header"><a href="/article/.vuepress/dist/2019/f9/skin-change.html#逐层传递皮肤切换" class="sidebar-link">逐层传递皮肤切换</a></li></ul></li></ul></li><li><a href="/article/.vuepress/dist/2019/f9/skin-builder.html" class="sidebar-link">F9 在线换肤工具</a></li></ul> </aside> <main class="page"> <div class="content default"><h1 id="f9-换肤实现方式优化"><a href="#f9-换肤实现方式优化" aria-hidden="true" class="header-anchor">#</a> F9 换肤实现方式优化</h1> <p>F9 框架中提供皮肤切换功能，其实现就是加载不同的样式文件，从而进行不同的效果展示。常规方式有如下两种：</p> <ol><li>在 <code>html</code> 或 <code>body</code> 加入一个全局 class 控制样式切换。</li> <li>改变 <code>link</code> 标签的 <code>href</code> 地址 (之前采用的方案)。</li></ol> <p>目前找到了更好的实现方案，直接上图进行对比：</p> <p><img src="/article/.vuepress/distassets/img/skinChange2.909ab286.gif" alt="对比图"></p> <p>上方为优化修改后的新方案，下方为之前的方案。</p> <h2 id="常规方式的问题："><a href="#常规方式的问题：" aria-hidden="true" class="header-anchor">#</a> 常规方式的问题：</h2> <p>第一种方案的的问题太多：样式优先级过高，难以复写和维护，之前实现时就没有考虑。</p> <p>第二种方案我们的具体实现步骤如下：</p> <ol><li>页面加载时，读取 cookie 加载当前使用的皮肤，并在对应的 link 标签上加上 id 标识。</li> <li>皮肤切换时，根据新的皮肤名称，拼接对应的皮肤路径，重新赋值给上一步中对应的 link 标签。</li> <li>浏览器卸载原有皮肤样式，请求加载新的皮肤样式文件，渲染新的皮肤文件。</li></ol> <p>以上过程中存在以下问题：卸载原有皮肤到新皮肤的加载渲染完成是需要一定的时间，这段时间内，控件将丢失颜色。</p> <p>这个时间可长可短，具体取决于网络速度以及浏览器性能。不过可以明确的时，这个差异，肉眼可见，而且相对明显。</p> <h2 id="新的实现方案"><a href="#新的实现方案" aria-hidden="true" class="header-anchor">#</a> 新的实现方案</h2> <h3 id="核心原理-alternative-style-sheets"><a href="#核心原理-alternative-style-sheets" aria-hidden="true" class="header-anchor">#</a> 核心原理 - alternative style sheets</h3> <p><strong><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Alternative_style_sheets" target="_blank" rel="noopener noreferrer">alternative style sheets<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></strong> 即在页面中加入其它备选替代样式表文件，可供用户切换应用。</p> <p>MDN 上关于此的解释如下：</p> <blockquote><p>Specifying alternative style sheets in a web page provides a way for users to see multiple versions of a page, based on their needs or preferences.
Firefox lets the user select the stylesheet using the View &gt; Page Style submenu. Internet Explorer also supports this feature (beginning with IE 8), also accessed from View &gt; Page Style. Chrome requires an extension to use the feature (as of version 48). The web page can also provide its own user interface to let the user switch styles.</p></blockquote> <h3 id="实现-demo"><a href="#实现-demo" aria-hidden="true" class="header-anchor">#</a> 实现 demo</h3> <p>以上描述并不好理解，以代码来描述：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 默认生效的样式 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>default.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text/css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>蓝色<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token comment">&lt;!-- 其它备选样式 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>red.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>alternate stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text/css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>红色<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>green.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>alternate stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text/css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>绿色<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>以上以 link 标签引入了三个样式文件，其中 <code>rel=&quot;stylesheet&quot;</code> 就是我们正常的写法，样式文件正常加载、直接生效。</p> <p>而其他两个 <code>rel=&quot;alternate stylesheet&quot;</code> 且具有 <code>title</code> 属性的样式文件将被以较低的优先级进行加载，但是不生效，用户可手动启用。</p> <p>而如何启用呢？ 只需要操作 HTML 标签原生的 <code>disabled</code> 属性即可， 以启用红色皮肤为例：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'link[title]'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'disabled'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">'[href=&quot;red.css&quot;]'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'disabled'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>效果演示请点击： <a href="https://fe.epoint.com.cn/fedemo/pages/skinchange/" target="_blank" rel="noopener noreferrer">https://fe.epoint.com.cn/fedemo/pages/skinchange/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="实现总结"><a href="#实现总结" aria-hidden="true" class="header-anchor">#</a> 实现总结</h3> <ol><li>页面中直接加载所有的皮肤文件
<ul><li><strong>注意需要为皮肤文件的 link 标签加入 <code>title</code> 属性</strong></li> <li>直接生效的样式文件按照正常的写法添加 <code>rel</code> 属性，即 'rel=&quot;stylesheet&quot;'</li> <li>备选样式（即其他皮肤文件）的 <code>rel</code> 属性中加上 <code>&quot;alternate&quot;</code> 即 <code>rel=&quot;alternate stylesheet&quot;</code></li></ul></li> <li>切换皮肤时，操作相关皮肤文件 <code>link</code> 标签的 <code>disabled</code> 属性即可，启用的为 <code>false</code></li></ol> <h2 id="在-f9-中的应用"><a href="#在-f9-中的应用" aria-hidden="true" class="header-anchor">#</a> 在 F9 中的应用</h2> <p>上面介绍了这种方案的基本原理和简单实现，以下聊聊这种方案在 F9 皮肤切换的具体实现。</p> <h3 id="输出所有的样式文件"><a href="#输出所有的样式文件" aria-hidden="true" class="header-anchor">#</a> 输出所有的样式文件</h3> <p>F9 中皮肤文件主要分为如下三个部分：</p> <ul><li>公共布局皮肤样式</li> <li>miniui 控件样式</li> <li>主界面样式</li></ul> <p>F9.4 对资源进行优化 <strong>公共布局</strong> 和 <strong>miniui 控件</strong> 被整合到了一起。</p> <p>只需拿到相关皮肤，按照规范格式输入 link 标签即可。</p> <p>另外在 F9 没有直接利用 <code>rel=&quot;alternate stylesheet&quot;</code> 本身的迟延加载功能，因为在 F9 中 jsboot 会统一输出一些通用框架资源，浏览器自身实现的备选样式较低的优先级，相对于 F9 框架相关资源来说，优先级还是相对较高，因此我们对非当前使用的皮肤资源进行进一步的迟延加载。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token comment">/**
     * 输出皮肤资源
     * @param {Boolean} isTheme 是否主界面
     * @param {string} themeName 主题名称
     * @param {array&lt;skin&gt;} skins 皮肤数组
     * @param {string} currSkin 应用中的皮肤
     * @dep
     */</span>
    <span class="token function-variable function">outputSkin</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">isTheme<span class="token punctuation">,</span> themeName<span class="token punctuation">,</span> skins<span class="token punctuation">,</span> currSkin</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
            l <span class="token operator">=</span> skins<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
            skin<span class="token punctuation">,</span>
            uiSkinPrefix <span class="token operator">=</span> <span class="token string">'frame/fui/mutableui/skins/'</span><span class="token punctuation">,</span>
            themeSkinPrefix <span class="token operator">=</span> <span class="token string">'frame/fui/pages/themes/'</span> <span class="token operator">+</span> themeName <span class="token operator">+</span> <span class="token string">'/skins/'</span><span class="token punctuation">,</span>
            name <span class="token operator">=</span> <span class="token operator">!</span>isTheme <span class="token operator">?</span> <span class="token string">'fui-ui-style'</span> <span class="token punctuation">:</span> <span class="token string">'fui-theme-style'</span><span class="token punctuation">,</span>
            delayArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            isCurr <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            linkStr <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            skin <span class="token operator">=</span> skins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            isCurr <span class="token operator">=</span> skin<span class="token punctuation">.</span>name <span class="token operator">===</span> currSkin<span class="token punctuation">;</span>
            linkStr <span class="token operator">=</span> <span class="token string">'&lt;link rel=&quot;stylesheet'</span> <span class="token operator">+</span> <span class="token punctuation">(</span>isCurr <span class="token operator">?</span> <span class="token string">''</span> <span class="token punctuation">:</span> <span class="token string">' alternate'</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                <span class="token string">'&quot; name=&quot;'</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'&quot; data-name=&quot;'</span> <span class="token operator">+</span> skin<span class="token punctuation">.</span>name <span class="token operator">+</span>
                <span class="token string">'&quot; title=&quot;'</span> <span class="token operator">+</span> <span class="token punctuation">(</span>skin<span class="token punctuation">.</span>cname <span class="token operator">||</span> skin<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token operator">+</span>
                <span class="token string">'&quot; href=&quot;'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleResPath</span><span class="token punctuation">(</span><span class="token punctuation">(</span>uiSkinPrefix <span class="token operator">+</span> skin<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'/skin.css'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'&quot;/&gt;'</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>isTheme<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                linkStr <span class="token operator">+=</span> <span class="token string">'&lt;link rel=&quot;stylesheet'</span> <span class="token operator">+</span> <span class="token punctuation">(</span>isCurr <span class="token operator">?</span> <span class="token string">''</span> <span class="token punctuation">:</span> <span class="token string">' alternate'</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                    <span class="token string">'&quot; name=&quot;'</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'&quot; data-name=&quot;'</span> <span class="token operator">+</span> skin<span class="token punctuation">.</span>name <span class="token operator">+</span>
                    <span class="token string">'&quot; title=&quot;'</span> <span class="token operator">+</span> <span class="token punctuation">(</span>skin<span class="token punctuation">.</span>cname <span class="token operator">||</span> skin<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token operator">+</span>
                    <span class="token string">'&quot; href=&quot;'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleResPath</span><span class="token punctuation">(</span><span class="token punctuation">(</span>themeSkinPrefix <span class="token operator">+</span> skin<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'/skin.css'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'&quot;/&gt;'</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 当前使用的直接输出 其他皮肤迟延加载</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>isCurr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">output</span><span class="token punctuation">(</span>linkStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                delayArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>linkStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>delayArr<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'head'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">insertAdjacentHTML</span><span class="token punctuation">(</span><span class="token string">'beforeend'</span><span class="token punctuation">,</span> delayArr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> isTheme <span class="token operator">?</span> <span class="token number">1000</span> <span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">function</span> <span class="token function">output</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            document<span class="token punctuation">.</span><span class="token function">writeln</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><h3 id="逐层传递皮肤切换"><a href="#逐层传递皮肤切换" aria-hidden="true" class="header-anchor">#</a> 逐层传递皮肤切换</h3> <p>此外F9中皮肤会以iframe的方式嵌入很多 tab ，dialog 弹出页面也都是iframe加载的。切换皮肤时必须确保每个 iframe 中的皮肤都被正确切换，否则将会出现一部分绿色皮肤、另一个页面还是红色皮肤的情况。</p> <p>解决此问题，F9中应用的方案是：</p> <ol><li>页面获取所有子 iframe ， 利用 <code>postMessage</code> 传递皮肤切换消息。</li> <li>子页面切换皮肤，并在获取自身页面的所有子 iframe 继续派发皮肤切换消息。</li></ol> <p>相关代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> skinSwitcher <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">updateSkin</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">skin</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'[name=&quot;fui-ui-style&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'disabled'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">'[data-name=&quot;'</span> <span class="token operator">+</span> skin <span class="token operator">+</span> <span class="token string">'&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'disabled'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'[name=&quot;fui-theme-style&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'disabled'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">'[data-name=&quot;'</span> <span class="token operator">+</span> skin <span class="token operator">+</span> <span class="token string">'&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'disabled'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">postToChild</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">skin<span class="token punctuation">,</span> hasSelf</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> iframes <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>hasSelf<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                that<span class="token punctuation">.</span><span class="token function">_postMessage</span><span class="token punctuation">(</span>win<span class="token punctuation">,</span> skin<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            $<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>iframes<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> ifr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    that<span class="token punctuation">.</span><span class="token function">_postMessage</span><span class="token punctuation">(</span>ifr<span class="token punctuation">.</span>contentWindow<span class="token punctuation">,</span> skin<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            iframes <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        iframes <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">_postMessage</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">aimWin<span class="token punctuation">,</span> skin</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        aimWin<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            type<span class="token punctuation">:</span> <span class="token string">'skinChange'</span><span class="token punctuation">,</span>
            skin<span class="token punctuation">:</span> skin
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">init</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token function">$</span><span class="token punctuation">(</span>win<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            event <span class="token operator">=</span> event<span class="token punctuation">.</span>originalEvent<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">'skinChange'</span> <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">.</span>skin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    that<span class="token punctuation">.</span><span class="token function">updateSkin</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>skin<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    that<span class="token punctuation">.</span><span class="token function">postToChild</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>skin<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
skinSwitcher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/article/.vuepress/dist/2018/how-to-responsive-web.html" class="prev">
          开发响应式网页
        </a></span> <span class="next"><a href="/article/.vuepress/dist/2019/f9/skin-builder.html">
          F9 在线换肤工具
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/article/.vuepress/dist/assets/js/app.fb069581.js" defer></script><script src="/article/.vuepress/dist/assets/js/2.b967c328.js" defer></script><script src="/article/.vuepress/dist/assets/js/6.d2e3d37b.js" defer></script>
  </body>
</html>
